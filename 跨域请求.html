<!DOCTYPE html>
<html>
  <head>
    <title>跨域请求</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link href="resources/css/jquery-ui-themes.css" type="text/css" rel="stylesheet"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/跨域请求/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-1.7.1.min.js"></script>
    <script src="resources/scripts/jquery-ui-1.8.10.custom.min.js"></script>
    <script src="resources/scripts/prototypePre.js"></script>
    <script src="data/document.js"></script>
    <script src="resources/scripts/prototypePost.js"></script>
    <script src="files/跨域请求/data.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
  </head>
  <body>
    <div id="base" class="">

      <!-- Unnamed (矩形) -->
      <div id="u103" class="ax_default sticky_1">
        <div id="u103_div" class=""></div>
        <div id="u103_text" class="text ">
          <p><span>AJAX 跨域问题</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u104" class="ax_default sticky_3">
        <div id="u104_div" class=""></div>
        <div id="u104_text" class="text ">
          <p><span style="font-family:'思源黑体 CN';font-weight:400;">同源策略规定，AJAX 请求（XMLHttpRequest）只能发给同源的网址，否则就会出错。所谓的同源策略是指 3 个相同：</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">协议相同、域名相同、端口相同</span><span style="font-family:'思源黑体 CN';font-weight:400;">。AJAX 跨域的根本原因是</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">浏览器不允许</span><span style="font-family:'思源黑体 CN';font-weight:400;">这么做（不是服务端的问题），浏览器限制 AJAX 跨域请求的目的是为了保证用户信息的安全，防止数据被恶意获取。</span></p>
        </div>
      </div>

      <!-- Unnamed (连接符) -->
      <div id="u105" class="ax_default _连接符">
        <img id="u105_seg0" class="img " src="images/跨域请求/u105_seg0.png" alt="u105_seg0"/>
        <img id="u105_seg1" class="img " src="images/http__/u66_seg3.png" alt="u105_seg1"/>
        <div id="u105_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u106" class="ax_default sticky_4">
        <div id="u106_div" class=""></div>
        <div id="u106_text" class="text ">
          <p><span style="font-family:'思源黑体 CN';font-weight:400;">AJAX 跨域问题主要有三种解决方法，</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">JSONP</span><span style="font-family:'思源黑体 CN';font-weight:400;">、</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">CORS</span><span style="font-family:'思源黑体 CN';font-weight:400;">(跨域资源共享)、</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">document.domain + iframe</span></p>
        </div>
      </div>

      <!-- Unnamed (连接符) -->
      <div id="u107" class="ax_default _连接符">
        <img id="u107_seg0" class="img " src="images/跨域请求/u107_seg0.png" alt="u107_seg0"/>
        <img id="u107_seg1" class="img " src="images/http__/u88_seg3.png" alt="u107_seg1"/>
        <div id="u107_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>

      <!-- Unnamed (组合) -->
      <div id="u108" class="ax_default" data-left="1497" data-top="215" data-width="656" data-height="718">

        <!-- Unnamed (矩形) -->
        <div id="u109" class="ax_default sticky_4">
          <div id="u109_div" class=""></div>
          <div id="u109_text" class="text ">
            <p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">JSONP</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">原理：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">动态插入 &lt;script&gt; 标签（因为&lt;script&gt; 标签不受同源策略的限制），通过插入 &lt;script&gt; 标签引入一个 js 文件，这个 js 文件加载成功之后会执行我们在 URL 中指定的回调函数，并且会把我们需要的json数据作为参数传入。</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">弊端：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">1. 需要在后端改动代码，比如在 Spring 后台代码中需要配置一个 AbstractJsonpResponseBodyAdvice 切面，不过现在这个类已经过时了，也就是说现在</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">不推荐使用 JSONP 来解决跨域问题</span><span style="font-family:'思源黑体 CN';font-weight:400;">。</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">2. JSONP 默认</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">只支持 GET</span><span style="font-family:'思源黑体 CN';font-weight:400;"> 方式的请求</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">3. 发送的不是 XMLHttpRequest 请求（script），所以</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">不支持异步事件</span><span style="font-family:'思源黑体 CN';font-weight:400;">等，不过这也是为什么 JSONP 可以解决跨域问题的原因</span></p>
          </div>
        </div>

        <!-- Unnamed (图像) -->
        <div id="u110" class="ax_default image">
          <img id="u110_img" class="img " src="images/跨域请求/u110.png"/>
        </div>
      </div>

      <!-- Unnamed (组合) -->
      <div id="u111" class="ax_default" data-left="292" data-top="461" data-width="504" data-height="373">

        <!-- Unnamed (矩形) -->
        <div id="u112" class="ax_default sticky_4">
          <div id="u112_div" class=""></div>
          <div id="u112_text" class="text ">
            <p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">document.domain + iframe</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">此方案仅限主域相同，子域不同的跨域应用场景。</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">原理：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">两个页面都通过js强制设置 document.domain 为基础主域，就可实现同域。</span></p>
          </div>
        </div>

        <!-- Unnamed (图像) -->
        <div id="u113" class="ax_default image">
          <img id="u113_img" class="img " src="images/跨域请求/u113.png"/>
        </div>
      </div>

      <!-- Unnamed (组合) -->
      <div id="u114" class="ax_default" data-left="384" data-top="943" data-width="1769" data-height="1338">

        <!-- Unnamed (组合) -->
        <div id="u115" class="ax_default" data-left="384" data-top="944" data-width="666" data-height="1337">

          <!-- Unnamed (矩形) -->
          <div id="u116" class="ax_default sticky_4">
            <div id="u116_div" class=""></div>
            <div id="u116_text" class="text ">
              <p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">CORS</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">原理：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">服务器在响应头中设置相应的选项，浏览器如果支持这种方法的话就会将这种跨站资源请求视为合法，进而获取资源。</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">CORS 请求可以分为两类：</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">简单请求与非简单请求</span><span style="font-family:'思源黑体 CN';font-weight:400;">，主要区别是非简单请求在进行访问之前，会发送一个</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">预检请求</span><span style="font-family:'思源黑体 CN';font-weight:400;">。“预检”请求首先通过 OPTIONS 方法向另一域上的资源发送HTTP请求，以便确定实际请求是否安全发送。为了防止每次非简单请求之前都发送预检请求，可以在服务端设置预检请求的缓存的时间。</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">JSONP只支持GET请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">1.&nbsp; 简单请求</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">1.1 请求方法为 </span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">HEAD、GET、POST</span><span style="font-family:'思源黑体 CN';font-weight:400;"> 中的 1 种</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">1.2 请求的 header 中没有自定义的请求头</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">1.3</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"> </span><span style="font-family:'思源黑体 CN';font-weight:400;">Content-Type 为以下几种：</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">application/x-www-form-urlencoded、multipart/form-data、text/plain</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">2</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">. 非简单请求</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">2.1 header 中包含</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">自定义请求头</span><span style="font-family:'思源黑体 CN';font-weight:400;"> 的 AJAX 请求</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">2.2 </span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">PUT、DELETE</span><span style="font-family:'思源黑体 CN';font-weight:400;"> 形式的 AJAX 请求</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">2.3 Content-Type 字段的类型是 </span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">application/json</span><span style="font-family:'思源黑体 CN';font-weight:400;"> 等</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u117" class="ax_default sticky_4">
            <div id="u117_div" class=""></div>
            <div id="u117_text" class="text ">
              <p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">简单请求</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">// 请求头：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Origin: http://www.domain.com</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">// 响应头：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Origin: http://www.domain.com</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Credentials: true&nbsp;&nbsp; `是否允许传送cookie`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Expose-Headers: FooBar `CORS请求时，只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如果想拿到其他字段，就必须指定。`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">!! AJAX 请求中,如果要发送Cookie，Access-Control-Allow-Origin 不能设为星号，必须指定明确的、与请求网页一致的域名，还要设置以下内容：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">var xhr = new XMLHttpRequest();</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">xhr.withCredentials = true;</span></p>
            </div>
          </div>

          <!-- Unnamed (矩形) -->
          <div id="u118" class="ax_default sticky_4">
            <div id="u118_div" class=""></div>
            <div id="u118_text" class="text ">
              <p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">非简单请求</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">// 预检请求：</span></p><p><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">OPTIONS /cors HTTP/1.1&nbsp; `OPTIONS请求是用来询问的`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Origin: http://www.domian.com</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Request-Method: PUT</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Request-Headers: X-Custom-Header</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">/</span><span style="font-family:'思源黑体 CN Bold', '思源黑体 CN Regular', '思源黑体 CN';font-weight:700;">/ 响应头：</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Origin: http://www.domain.com</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Methods: GET, POST, PUT&nbsp; `服务器支持的所有跨域请求的方法`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Headers: X-Custom-Header&nbsp; `服务器支持的所有头信息字段，不限于浏览器在&quot;预检&quot;中请求的字段。`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Allow-Credentials: true</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">Access-Control-Max-Age: 1728000&nbsp; `指定本次预检请求的有效期，单位为秒`</span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;"><br></span></p><p><span style="font-family:'思源黑体 CN';font-weight:400;">// 之后同简单请求</span></p>
            </div>
          </div>
        </div>

        <!-- Unnamed (图像) -->
        <div id="u119" class="ax_default image">
          <img id="u119_img" class="img " src="images/跨域请求/u119.png"/>
        </div>
      </div>

      <!-- Unnamed (连接符) -->
      <div id="u120" class="ax_default _连接符">
        <img id="u120_seg0" class="img " src="images/跨域请求/u120_seg0.png" alt="u120_seg0"/>
        <img id="u120_seg1" class="img " src="images/跨域请求/u120_seg1.png" alt="u120_seg1"/>
        <img id="u120_seg2" class="img " src="images/跨域请求/u120_seg2.png" alt="u120_seg2"/>
        <img id="u120_seg3" class="img " src="images/跨域请求/u120_seg3.png" alt="u120_seg3"/>
        <div id="u120_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>

      <!-- Unnamed (连接符) -->
      <div id="u121" class="ax_default _连接符">
        <img id="u121_seg0" class="img " src="images/跨域请求/u121_seg0.png" alt="u121_seg0"/>
        <img id="u121_seg1" class="img " src="images/跨域请求/u121_seg1.png" alt="u121_seg1"/>
        <img id="u121_seg2" class="img " src="images/http__/u99_seg2.png" alt="u121_seg2"/>
        <img id="u121_seg3" class="img " src="images/http__/u99_seg3.png" alt="u121_seg3"/>
        <div id="u121_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>

      <!-- Unnamed (连接符) -->
      <div id="u122" class="ax_default _连接符">
        <img id="u122_seg0" class="img " src="images/跨域请求/u122_seg0.png" alt="u122_seg0"/>
        <img id="u122_seg1" class="img " src="images/跨域请求/u122_seg1.png" alt="u122_seg1"/>
        <img id="u122_seg2" class="img " src="images/跨域请求/u122_seg2.png" alt="u122_seg2"/>
        <img id="u122_seg3" class="img " src="images/跨域请求/u122_seg3.png" alt="u122_seg3"/>
        <div id="u122_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
    </div>
  </body>
</html>
